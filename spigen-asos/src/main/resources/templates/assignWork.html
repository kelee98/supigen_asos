<!DOCTYPE html>
<html lang="en">
  <!-- 공통 Config -->
  <head th:replace="config::configFragment">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="">
  <meta name="author" content="Mark Otto, Jacob Thornton, and Bootstrap contributors">
  <meta name="generator" content="Jekyll v4.0.1">

  </head>
  <!-- 공통 헤더-->
  <header th:replace="topbar::topbarFragment"></header>
  <body>
  	<form name="menuFrm">
   		<input type="hidden"> 	
   	</form>
    <form name="searchFrm" id="searchFrm">
      	<input type="hidden" id="selectedMatnr" name="selectedMatnr" >
  		<input type="hidden" id="selectedIdnrk" name="selectedIdnrk" >
  		<input type="hidden" id="selectedSeq" name="selectedSeq" >
  		<input type="hidden" id="selectedCstlal" name="selectedCstlal" >
    <div class="container-fluid">
      <div class="row">	
      	<!-- left메뉴 -->
  		<nav th:replace="nav::sidebarMenu"></nav> 
		<main role="main" class="col-md-9 ml-sm-auto col-lg-10 px-md-4">
	<h2>작업할당</h2>
     <div class="search">
         <div class="card-body">
             <div class="row">
                 <div class="col-md-3 pl-1">
                     <div class="form-group">
                         <label class="searchLbl">임가공업체</label>
                         <select  id = "VdrList" name="VdrList" class="form-control">
	                         <option value="">선택</option>
	                         <option th:each="VendorList : ${VendorLists}" 
							  		 th:value="${VendorList.lifnr}" 
							  		 th:text="${VendorList.lifnr} + ' : ' + ${VendorList.bu_sort1}">
							  </option>
                         </select>
					</div>
                  </div>
                  <div class="col-md-3 pl-1">
                     <div class="form-group">
                         <label class="searchLbl">상품코드</label>
                         <input type="text" id="Code" name="Code" class="form-control" placeholder="Code">
                     </div>
                 </div>
                 <div class="col-md-3 pl-1">
                                      <div class="form-group">
                         <label class="searchLbl">상품명</label>
                         <input type="text" id="Name" name="Name" class="form-control" placeholder="Name">
                     </div>
                     
                 </div>
                 <div class="col-md-3 pl-1">
                 	<div class="form-group">
                         <label class="searchLbl">중단여부</label>
                         <select name="JobID" class="form-control">
                                 <option>정상</option>
                                 <option>중단</option>
                                 <option>전체</option>
                         </select>
                    </div>
                 </div>
             </div>
             <div class="row">
                 <div class="col-md-2 pl-1">
					<div class="form-group">
                         <label class="searchLbl">납기일자</label>
                         <input type="text" id="min-date1" class="form-control date-range-filter datepicker"  placeholder="From">
                     </div>
                 </div>
                 <div class="col-md-2 pl-1">
                 	<div class="form-group">
                         <label class="searchLbl">-</label>
                         <input type="text" id="max-date1" class="form-control date-range-filter datepicker" placeholder="To">
                     </div>
                 </div>
                 <div class="col-md-2 pl-1">
                     <div class="form-group">
                         <label class="searchLbl">지시일자</label>
                         <input type="text" id="min-date2" class="form-control date-range-filter datepicker" placeholder="From">
                     </div>
                 </div>
                 <div class="col-md-2 pl-1">
                     <div class="form-group">
                         <label class="searchLbl">-</label>
                         <input type="text" id="max-date2" class="form-control date-range-filter datepicker"  placeholder="To">
                     </div>
                 </div>
                 <div class="col-md-4 pl-1">
                     <div class="form-group">
			             <div class="search-btn-div">
			             	<button class="btn btn-dark btn-lg" id="search">조회</button> 
			             </div>
			          </div>
			     </div>
             </div>						
         </div>
     </div>
    <div class="pt-3 pb-2 mb-3 border-bottom">
     <h4><b>지시목록</b></h4>
      <div class="table-responsive">
      <div class = "tableWrapper">
        <table id="ordListTbl" class="table table-striped table-hover text-center table">
          <thead class="thead-dark">
            <tr>
              <th>#</th>
              <th>선택</th>           
              <th>지시번호</th>
              <th>지시일자</th>
              <th>납기일자</th>
              <th>완제품코드</th>
              <th>지시수량</th>
              <th>작업유형</th>              
              <th>생산업체</th>
              <th>박스현품표</th>
              <th>패킷가이드</th>
              <th>상태</th>
              <th>비고</th>
            </tr>
          </thead>
			<tbody id = "OdrListT">
          </tbody>
        </table>
      </div>
    </div>
    </div>
      <div class="pt-5 pb-2 mb-3 border-bottom">
         <h4><b>작업대할당</b></h4>
      <div class="table-responsive">
       <div class = "tableWrapper1">
        <table id="dataTable" class="table table-striped table">
          <thead class="thead-dark">
            <tr>
              <th>#</th>
              <th>작업대번호</th>
              <th>할당수량</th>
            </tr>
          </thead>
		<tbody>
		          <tr>
          		<td>1</td>
          		<td><input type="text" id="assignNo1" class="form-control date-range-filter"  placeholder="번호" size = "6"></td>
				<td><input type="text" id="assignQnt1" class="form-control date-range-filter"  placeholder="수량" size = "6"></td>
          </tr>
                    <tr>
          		<td>2</td>
          		<td><input type="text" id="assignNo2" class="form-control date-range-filter"  placeholder="번호" size = "6"></td>
				<td><input type="text" id="assignQnt2" class="form-control date-range-filter"  placeholder="수량" size = "6"></td>
          </tr>
                    <tr>
          		<td>3</td>
          		<td><input type="text" id="assignNo3" class="form-control date-range-filter"  placeholder="번호" size = "6"></td>
				<td><input type="text" id="assignQnt3" class="form-control date-range-filter"  placeholder="수량" size = "6"></td>
          </tr>
          </tbody>
        </table>
        
      </div>
    </div>
    </div>
    <div class="form-group">
			<a class="btn btn-dark btn " href="#"><i class="fa fa-filter "></i>시작</a>
	</div>
       <div class="pt-5 pb-2 mb-3 border-bottom">
         <h4><b>할당리스트</b></h4>
      <div class="table-responsive">
    	<div class = "tableWrapper">
        <table id="dataTable" class="table table-striped table">
          <thead class="thead-dark">
            <tr>
              <th>#</th>
              <th>작업대번호</th>
              <th>순번</th>
              <th>수량</th>
              <th>상태</th>
              <th>할당취소</th>
              <th>바코드출력</th>
              <th>바코드추가발행</th>
              <th>단위</th>
              <th>수량</th>
              <th>작업유형</th>
              <th>비고</th>
            </tr>
          </thead>
			<tbody>
          </tbody>
        </table>
        </div>
      </div>
    </div>
</main>
      </div>
     </div>
     </form>
     <script>
     function AddOrd(){
    	    $( "#Addord" ).append(
    	   		 "<tr>" +
    	   		 	"<td>"  + "</td>" +
    	   		 	"<td>" + "<input class = 'form-control' type='text' size='6' name='pkcode' value=''>" + "</td>" +
    	   		 	"<td>" + "<input class = 'form-control' type='text' size='6' name='pkcode' value='심재원'>" + "</td>" +
    	   		 	"<td>" + "<input type='text' id='min-date' name='orddat' class='form-control date-range-filter datepicker' placeholder='지시일자' size = '6'>" + "</td>" +
    	   		 	"<td>" + "<input type='text' id='max-date' name='orddat' class='form-control date-range-filter datepicker' placeholder='지시일자' size = '6'>" + "</td>" +
    	   		 	"<td>" + "<select class= 'form-control' name='wktype'><option value='선택1'>선택1</option><option value='선택2'>선택2</option></select>" + "</td>" +
    	   		 	"<td>" + "<input class = 'form-control' type='text' size='6' name='pkcode' value=''>" + "</td>" +	
    	   		 	"</tr>"
    	                );
    	}

    	$(document).ready(function() {
    		//debugger;
    		feather.replace();
    		fnInitMenu("nav18");
    	    
    	    $("#search").click(function(){
    	        $.ajax({ //지시목록
    	        	method: "GET",
    	            url: "/api/v1/get/OdrList",
    	            dataType: "json",
    	            data:{
    	             value: $("#VdrList").val()
    	                    },
    	                  })
    	         .done(function( data ) {
    	          	console.log("data return: ",data)

    	             $( "#OdrListT" ).empty();
    	             data.forEach(function(item, index) {//전달인자로 함수(인자1: 배열원소의값 인자2:인덱스 인자3: 배열 그 자체) map도 가능
    	            	 $( "#OdrListT" ).append(
    	            		 "<tr>" +
    	            		 	"<td>" + (index+1) + "</td>" +
    	                        "<td>" + "<input type=checkbox id='selected' name='selected' value="+ item.wkonum + " >" + "</td>" +
    	                        "<td>" + item.wkonum + "</td>" +
    	                      	"<td>" + item.assycd + "</td>" +
    	                      	"<td>" + item.ospser + "</td>" +
    	                      	"<td>" + item.qtyord + "</td>" +
    	                      	"<td>" + item.creusr + "</td>" +
    	                      	"<td>" + item.credat + "</td>" +
    	                      	"<td>" + item.sddate + "</td>" +
    	                      	"<td>" + item.wktype + "</td>" +
    	                      	"<td>" + item.remark + "</td>" +
    	                      "</tr>"
    	                         );
    	                   })
    	            });
    	      });
    	   
    	    
    	    $("#btnRegisterOrder").click(function(){ //지시하기 등록
    	       	//alert($("#registerOrder").serialize());
    	    	if($("#VdrList").val() != ""){
    		       	$.ajax({
    		            type : 'POST',
    		            data : $("#registerOrder").serialize() + "&cornum=" + $("#VdrList").val(),
    		            dataType: 'json',
    		            url :  '/api/v1/get/registerOdr',
    		            
    		            success : function(data) { //http요청에 성공했을경우
    		            	alert("등록 완료");
    		            	console.log( "Data return :", data );
    		             //$( "#OdrListT" ).empty();
    		             data.forEach(function(item, index) {//전달인자로 함수(인자1: 배열원소의값 인자2:인덱스 인자3: 배열 그 자체) map도 가능
    		             //console.log("@@@"+ item.wkonum);
    		             $( "#OdrList" ).append(
    		            		 "<tr>" +
    		            		 	"<td>" + (index+1) + "</td>" +
    		                        "<td>" + "<input type=checkbox id='selected' name='selected' value="+ item.wkonum + " >" + "</td>" +
    		                        "<td>" + item.wkonum + "</td>" +
    		                      	"<td>" + item.assycd + "</td>" +
    		                      	"<td>" + item.ospser + "</td>" +
    		                      	"<td>" + item.qtyord + "</td>" +
    		                      	"<td>" + item.creusr + "</td>" +
    		                      	"<td>" + item.credat + "</td>" +
    		                      	"<td>" + item.sddate + "</td>" +
    		                      	"<td>" + item.wktype + "</td>" +
    		                      	"<td>" + item.remark + "</td>" +
    		                      "</tr>"
    		                         );
    		                   })
    		            },
    		            error : function(request,status){
    		            	alert("등록 실패");
    		            }
    		  		});
    		       	//return false;
    	    	}
    	    	else{
    	    		alert("공급업체 선택하쇼")
    	    	}
    	    	//return false;
    	      });
    	    
    	    $("#btnDeleteOrder").click(function(){ //지시하기 등록
    	       	//alert($("#registerOrder").serialize());

    	 		   var checkArr = new Array();
    	 		  // var param = $("form[name=form]").serialize();
    	 		   var list = $("input[name='selected']");
    	 		   console.log(list);
    	 		    for(var i = 0; i < list.length ; i++){
    	 		        if(list[i].checked){ //선택되어 있으면 배열에 값을 저장함
    	 		            checkArr.push(list[i].value);
    	 		            console.log("@@@"+list[i].value);
    	 		        }
    	 		    }
    	 		    console.log("chekArr=" + checkArr);
    	            console.log("hihi=" +$("#VdrList").val() );

    	 		    $.ajax({
    		            type : 'POST',
    		            data : {select : checkArr, hi: $("#VdrList").val() },
    		            dataType: 'json',
    		            traditional:true,
    		            url :  "/api/v1/get/deleteOdr",
    		            success : function(data) { //http요청에 성공했을경우
    		            	alert("삭제 완료");
    			           	 console.log( "Data return :", data );
    			             $( "#OdrListT" ).empty();
    			             data.forEach(function(item, index) {//전달인자로 함수(인자1: 배열원소의값 인자2:인덱스 인자3: 배열 그 자체) map도 가능
    			             console.log("@@@"+ item.odrcode);
    			             $( "#OdrListT" ).append(
    			            		 "<tr>" +
    			            		 	"<td>" + (index+1) + "</td>" +
    			                        "<td>" + "<input type=checkbox id='selected' name='selected' value="+ item.wkonum + " >" + "</td>" +
    			                        "<td>" + item.wkonum + "</td>" +
    			                      	"<td>" + item.worder + "</td>" +
    			                      	"<td>" + item.orddat + "</td>" +
    			                      	"<td>" + item.credat + "</td>" +
    			                      	"<td>" + item.wktype + "</td>" +
    			                      	"<td>" + item.remark + "</td>" +
    			                      "</tr>"
    			                         );
    			                   })
    		            },
    		            error : function(request,status){
    		            	alert("삭제 실패");
    		            }
    		  		});
    	      });
    	});
     </script>
     </body>
     </html>