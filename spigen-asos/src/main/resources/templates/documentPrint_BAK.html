<!DOCTYPE html>
<html lang="en">
  <!-- 공통 Config -->
  <head th:replace="config::configFragment">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="">
  <meta name="author" content="Mark Otto, Jacob Thornton, and Bootstrap contributors">
  <meta name="generator" content="Jekyll v4.0.1">
  </head>
  <!-- 공통 헤더-->
  <header th:replace="topbar::topbarFragment"></header>
  <body>
  	<form name="menuFrm">
   		<input type="hidden"> 	
   	</form>
	<form id="printFrm" name="printFrm">
		<input type ="hidden" id="chkFiles"  name="chkFiles" value="">
	</form>
    <form name="searchFrm" id="searchFrm">
    <div class="container-fluid">
      <div class="row">	
      	<!-- left메뉴 -->
  		<nav th:replace="nav::sidebarMenu"></nav> 
		<main role="main" class="col-md-9 ml-sm-auto col-lg-10 px-md-4">
          <div class="pt-3 pb-2 mb-3 border-bottom">
            <h2>수출입 서류 조회(세무서)</h2>
		   <div class="search">                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
			<ul>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
			  <li class="title2">                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
			  <label class="lb2"><span class="tx">선적서류번호</span></label>                                                                                                                                                                                                                                                                                                                                                                                                                                                     
			  <input type="text" id="ciNo" name="ciNo" hname="Invoice" maxlength="20" class="inp_type">                                                                                                                                                                                                                                                                                                                                                                                                                                         
			  </li>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
			  <li class="title2">                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
			  <label class="lb2"><span>B/L관리번호</span></label>                                                                                                                                                                                                                                                                                                                                                                                                                                                   
			  <input type="text" id="blNo" name="blNo" hname="B/L" maxlength="20" class="inp_type_w100">                                                                                                                                                                                                                                                                                                                                                                                                                                      
			  </li>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
			</ul>
			<ul>
			  <li class="title2">                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
			  <label class="lb2"><span class="tx">* 조회기간</span></label>
			  <input type="radio" name="qryType" checked="checked" value="Q" onchange="chkRadio(this)"> 분기별			  
			  <input type="radio" name="qryType" style="margin-left: 5px" value="M" onchange="chkRadio(this)"> 월별		  
			  <input type="radio" name="qryType" style="margin-left: 5px" value="D" onchange="chkRadio(this)"> 일별		  
			  <span id="qryTypeQ" style="margin-left: 10px; font-weight: normal;" >
			  	  <input type="hidden" name="qryQBfr" id="qryQBfr" >
			  	  <input type="hidden" name="qryQAftr" id="qryQAftr">
				  	<select class="inp_type_w10" id="qryYear" name="qryYear">
					  	<option value="2021" selected="selected">2021</option>
					  	<option value="2020">2020</option>
					  	<option value="2019">2019</option>
					  	<option value="2018">2018</option>
					  	<option value="2017">2017</option>
				  </select> 
				  <input type="radio" name="qtrVal" style="margin-left: 5px" checked="checked" value="1"> 1분기			  
				  <input type="radio" name="qtrVal" style="margin-left: 5px" value="2"> 2분기		  
				  <input type="radio" name="qtrVal" style="margin-left: 5px" value="3"> 3분기		  
				  <input type="radio" name="qtrVal" style="margin-left: 5px" value="4"> 4분기		  
			  </span>
			  <span id="qryTypeM" style="margin-left: 10px;display: none;">
			  <input type="text" name="qryMBfr" id="qryMBfr" size="7" class="month_picker inp_type_w10"/ onblur="formatDate(this,'M')"> ~ 
			  <input type="text" name="qryMAftr" id="qryMAftr" size="7" class="month_picker inp_type_w10" onblur="formatDate(this,'M')"/>

<!-- 				  <input type="date" id="qryMBfr" name="qryBfr" hname="조회기간" maxlength="6" class="inp_type_w70" value="2020-08-13">&nbsp;&nbsp;~&nbsp;                                                                                                                                                                                                                                                                                                                                                                                                                                       -->
<!-- 				  <input type="date" id="qryMAftr" name="qryAftr" hname="조회기간" maxlength="6" class="inp_type_w70" value="2020-08-14">                                                                                                                                                                                                                                                                                                                                                                                                                                         -->
			  </span>
			  <span id="qryTypeD" style="margin-left: 10px;display: none;">
	  			  <input type="text" name="qryBfr" id="qryBfr" size="12" class="inp_type_w10" onblur="formatDate(this,'D')"> ~
	  			  <input type="text" name="qryAftr" id="qryAftr" size="12" class="inp_type_w10" onblur="formatDate(this,'D')">
			  			  
			  </span>
			  </li>
			  <li class="title6">                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
			  <label class="lb2"><span class="tx">파일형식</span></label>
			  	  <input type="radio" name="docType" value="CI" checked="checked"> CI
			  	  <input type="radio" name="docType" value="BL" style="margin-left: 1rem"> BL
			  	  <select name="fileType" style="margin-left: 1rem" class="inp_type_w70">
			  	  	<option value="">전체</option>
			  	  	<option value="pdf">pdf</option>
			  	  	<option value="excel">excel</option>
			  	  	<option value="etc">그 외</option>
			  	  </select>
			  </li> 
			  <li class="title7">                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
				<button type="button" id="qryBtn" name="qryBtn" value="조회" onclick="qryFileList()" class="btn btn-secondary btn-sm">
			  	<span data-feather="search"></span> 조회
			  	</button>
			  </li>
			</ul>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
		  </div>
		  <article class="article_list_table2">
            <div class="list-table2">
              <table id="gridList" class="table table-striped table-sm" style="width: 350%">
              	<colgroup>
					<col width="2%">
					<col width="2%">
					<col width="4%">
					<col width="2%">
					<col width="2%">
					<col width="2%">
					<col width="1%">
					<col width="5%">
					<col width="1.5%">
					<col width="2%">
					<col width="2%">
					<col width="5%">
					<col width="1.5%">
					<col width="2%">
					<col width="2%">
					<col width="2%">
					<col width="2%">
					<col width="2%">
					<col width="2%">
					<col width="3%">
					<col width="2%">
					<col width="2%">
					<col width="2%">
					<col width="2%">
					<col width="2%">
					<col width="2%">
					<col width="2%">
					<col width="2%">
					<col width="2%">
					<col width="2%">
					<col width="2%">
					<col width="2%">
					<col width="2%">
					<col width="2%">
					<col width="2%">
					<col width="2%">
					<col width="2%">
					<col width="2%">
					<col width="2%">
					<col width="4%">
					<col width="2%">
					<col width="2%">
					<col width="3%">
					<col width="1%">
					<col width="1%">
					<col width="1%">
				</colgroup>
                <thead>
                  <tr>
					<th scope="col" class='center'>On Board<br>Date</th>
					<th scope="col" class='center'>거래처</th>
					<th scope="col" class='center'>거래처명</th>
					<th scope="col" class='center'>Invoice No</th>
					<th scope="col" class='center'>전표통화품목<br>정가(금액)</th>
					<th scope="col" class='center'>선적서류번호</th>
					<th scope="col" class='center' style="display: none;">서류유형</th>
					<th scope="col" class='center'><input type="checkbox" id="checkAll" class="checkAll"></th>
					<th scope="col" class='center'>파일명(CI)</th>
					<th scope="col" class='center' style="display: none;">파일형식</th>
					<th scope="col" class='center'>수출문서<br>ID</th>
					<th scope="col" class='center'>B/L관리번호</th>
					<th scope="col" class='center' style="display: none;">서류유형</th>
					<th scope="col" class='center'><input type="checkbox" id="checkAll2" class="checkAll2"></th>
					<th scope="col" class='center'>파일명(B/L)</th>
					<th scope="col" class='center' style="display: none;">파일형식</th>
					<th scope="col" class='center'>수출문서<br>ID</th>
					<th scope="col" class='center'>납품</th>
					<th scope="col" class='center'>참조 문서 번호</th>
					<th scope="col" class='center'>선적번호</th>
					<th scope="col" class='center'>결제유형</th>
					<th scope="col" class='center'>참조 고객</th>
					<th scope="col" class='center'>FD 관리번호</th>
					<th scope="col" class='center'>House<br>B/L No.</th>
					<th scope="col" class='center'>Master<br>B/L No.</th>
					<th scope="col" class='center'>수출이행일</th>
					<th scope="col" class='center'>자재 번호</th>
					<th scope="col" class='center'>판매 오더<br>품목 내역</th>
					<th scope="col" class='center'>수출통관<br>관리번호</th>
					<th scope="col" class='center'>신고수리번호</th>
					<th scope="col" class='center'>신고수리일자</th>
					<th scope="col" class='center'>실제 자재<br>이동일</th>
					<th scope="col" class='center'>계획된 자재<br>이동일</th>
					<th scope="col" class='center'>청구 문서</th>
					<th scope="col" class='center'>청구일</th>
					<th scope="col" class='center'>실제 대금<br>청구 수량</th>
					<th scope="col" class='center'>판매 단위</th>
					<th scope="col" class='center'>SD문 통화</th>
					<th scope="col" class='center'>문서통화 <br>청구품목 정가</th>
					<th scope="col" class='center'>Forwarder</th>
					<th scope="col" class='center'>Forwarder명</th>
					<th scope="col" class='center'>납품처</th>
					<th scope="col" class='center'>납품처명</th>
					<th scope="col" class='center'>인도 조건<br>(파트 1)</th>
					<th scope="col" class='center'>인코텀스<br>(파트 2)</th>
					<th scope="col" class='center'>지급 조건 키</th>
					<th scope="col" class='center'>회사 코드</th>
					<th scope="col" class='center'>수출유형</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
	                <td></td>
	                <td></td>
	                <td></td>
	                <td></td>
	                <td></td>
	                <td></td>
	                <td></td>
	                <td></td>
	                <td></td>
	                <td></td>
	                <td></td>
	                <td></td>
	                <td></td>
	                <td></td>
	                <td></td>
	                <td></td>
	                <td></td>
	                <td></td>
	                <td></td>
	                <td></td>
	                <td></td>
	                <td></td>
	                <td></td>
	                <td></td>
	                <td></td>
	                <td></td>
	                <td></td>
	                <td></td>
	                <td></td>
	                <td></td>
	                <td></td>
	                <td></td>
	                <td></td>
	                <td></td>
	                <td></td>
	                <td></td>
	                <td></td>
	                <td></td>
	                <td></td>
	                <td></td>
	                <td></td>
	                <td></td>
	                <td></td>
	                <td></td>
	                <td></td>
	                <td></td>
	                <td></td>
	                <td></td>
	              </tr>
                </tbody>
              </table>
            </div>
            <div class="btnDivBtm">
              	<button type="button" id="printBtnFst" name="printBtnFst" value="PRINT" onclick="printFile('F')" class="btn btn-outline-secondary btn-sm" style="display: none;">
              	<span data-feather="printer"></span> 1page인쇄
              	</button>
              	<button type="button" id="printBtn" name="printBtn" value="PRINT" onclick="printFile('A')" class="btn btn-outline-primary btn-sm" style="display: none;">
              	<span data-feather="printer"></span> 전체인쇄
              	</button>
            </div>
            </article>
        	<!-- pagging -->
			<div class="paginate_complex">
				<div id="paging" class="paging">
					<div id="boardNavigation" class="boardNavigation">
						<input type="hidden" id="pageIndex" name="pageIndex" value="1"/>
						<div id="pagination" class="pagination"></div>
					</div>
				</div>
			</div>
			<!-- //pagging -->                 
          </div>
     	<iframe id="iFramePdf" src="" style="display: none;"></iframe>
      </main>
      </div>
     </div>
              <!-- progress bar -->
	<div id="progress"></div>
	<!-- end progress --> 
     </form>
  </body>
<script>
$(document).ready(function(){
	
	//분기 세팅
	var quarter = Math.ceil( currentMonth() / 3 );
	var year = currentYear();
	$('#qryYear').val(year);
	$("input[name=qryQuarter][value=" + quarter + "]").attr("checked", true);
	
	//전체선택
	$(".checkAll").click(function(){
		$(".chkList").prop("checked", this.checked);
	});
	
	$(".checkAll2").click(function(){
		$(".chkList2").prop("checked", this.checked);
	});
	
	feather.replace();
	
	fnInitMenu("nav1");
});

//현재 월 반환 함수
function currentMonth() {
	
	var d = new Date();
	var caledmonth;
	
	if( d.getMonth() < 9 ){
		caledmonth = '0'+(d.getMonth()+1);
	}else{
		caledmonth = d.getMonth()+1;
	}
	
	return caledmonth; // 현재 월만 반환
}

//현재 연도 반환 함수
function currentYear() {
var d = new Date();

return d.getFullYear(); // 현재 연도만 반환
}


function qryFileList(){
	
	if($('input[name=qryType]').val()=="Q"){
		var checkedVal = $('input[name=qtrVal]:checked').val();	
		var selectedYear = $('#qryYear').val();
		if(checkedVal=="1"){
			$('#qryQBfr').val(selectedYear+"-01-01");
			$('#qryQAftr').val(selectedYear+"-03-31");
		}else if(checkedVal=="2"){
			$('#qryQBfr').val(selectedYear+"-04-01");
			$('#qryQAftr').val(selectedYear+"-06-31");
		}else if(checkedVal=="3"){
			$('#qryQBfr').val(selectedYear+"-07-01");
			$('#qryQAftr').val(selectedYear+"-09-31");
		}else if(checkedVal=="4"){
			$('#qryQBfr').val(selectedYear+"-10-01");
			$('#qryQAftr').val(selectedYear+"-12-31");
		}
	}
	
	var sendData = $('#searchFrm').serialize();
	
   	$.ajax({
          type : 'POST',
          data : sendData,
          beforeSend : function(xhr)
          {   /*데이터를 전송하기 전에 헤더에 csrf값을 설정한다*/
				xhr.setRequestHeader(header, token); 
          },          
          dataType : 'json',
          url :  '/file/selectTaxFileMgrListQry',
          success : function(result) {
             onSuccess(result);
             $(".checkAll").prop("checked", false);
          },
          error : function(request,status){
              alert("조회 실패");
          }
	});
	
}

function fileViewer(obj, name, type){
	
//	var path = "C:/Users/User/Desktop/SAP DATA/운영3~4/" + name;
	var path = "classes/attach_files/"+ name;
	
	var url = "/file/fileViewerS3?filePath=" + escape(path) + "&fileType="+ type + "&fileNm="+ escape(name)+"&docType=P";

	if(type=="pdf"||type=="PDF"){
		openPopup(url, 850, 800);
	}else{
		location.href = url;
	}
}

function onSuccess(result){
	
	var htmltext="";    
    if(result.resultList.length == 0) {
        htmltext += "<tr>";
        htmltext += "<td colspan=\"48\" class='center'>조회 결과가 없습니다.</td>";
        htmltext += "</tr>";
		$('#printBtn').hide();
		$('#printBtnFst').hide();
    }else{

		for(var n = 0 ; n<result.resultList.length ; n ++){
			var resultVO = result.resultList[n];      
		    htmltext += "<tr>";
		    htmltext += "<td class='center'>"+resultVO.zobdt+"</td>";
		    htmltext += "<td class='center'>"+resultVO.kunnrR+"</td>";
		    htmltext += "<td class='center'>"+resultVO.name1R+"</td>";
		    htmltext += "<td class='center'>"+resultVO.zcivno+"</td>";
		    htmltext += "<td class='center'>"+resultVO.netwrIv+"</td>";
		    htmltext += "<td class='center'>"+resultVO.zexdno+"</td>";
		    htmltext += "<td class='center' style='display: none;'>"+resultVO.docTypeCI+"</td>";
		    htmltext += "<td class='center'><input type='checkbox' name='chkList' value='"+resultVO.fileNmCI+"' class='chkList'></td>";
		    htmltext += "<td class='center'><a href=\"javascript:fileViewer(this,\'"+resultVO.fileNmCI+"\',\'"+resultVO.fileTypeCI+"\', event)\" style='cursor:hand;'>"+resultVO.fileNmCI+"</a></td>";
		    htmltext += "<td class='center' style='display: none;'>"+resultVO.fileTypeCI+"</td>";
		    htmltext += "<td class='center'>"+resultVO.zexidCi+"</td>";
		    
		    htmltext += "<td class='center'>"+resultVO.zexbno+"</td>";
		    htmltext += "<td class='center' style='display: none;'>"+resultVO.docTypeBL+"</td>";
		    htmltext += "<td class='center'><input type='checkbox' name='chkList' value='"+resultVO.fileNmBL+"' class='chkList2'></td>";
		    htmltext += "<td class='center'><a href=\"javascript:fileViewer(this,\'"+resultVO.fileNmBL+"\',\'"+resultVO.fileTypeBL+"\', event)\" style='cursor:hand;'>"+resultVO.fileNmBL+"</a></td>";
		    htmltext += "<td class='center' style='display: none;'>"+resultVO.fileTypeBL+"</td>";
		    htmltext += "<td class='center'>"+resultVO.zexidBl+"</td>";
		    
		    htmltext += "<td class='center'>"+resultVO.vbeln+"</td>";
		    htmltext += "<td class='center'>"+resultVO.aubel+"</td>";
		    htmltext += "<td class='center'>"+resultVO.tknum+"</td>";
		    htmltext += "<td class='center'>"+resultVO.zreqty+"</td>";
		    htmltext += "<td class='center'>"+resultVO.bstnk+"</td>";
		    htmltext += "<td class='center'>"+resultVO.zexfno+"</td>";
		    htmltext += "<td class='center'>"+resultVO.zhblno+"</td>";
		    htmltext += "<td class='center'>"+resultVO.zmblno+"</td>";
		    htmltext += "<td class='center'>"+resultVO.zexdt+"</td>";
		    htmltext += "<td class='center'>"+resultVO.matnr+"</td>";
		    htmltext += "<td class='center'>"+resultVO.arktx+"</td>";
		    htmltext += "<td class='center'>"+resultVO.zexcno+"</td>";
		    htmltext += "<td class='center'>"+resultVO.zedsno+"</td>";
		    htmltext += "<td class='center'>"+resultVO.zedsdt+"</td>";
		    htmltext += "<td class='center'>"+resultVO.wadatList+"</td>";
		    htmltext += "<td class='center'>"+resultVO.wadat+"</td>";
		    htmltext += "<td class='center'>"+resultVO.vbelnK+"</td>";
		    htmltext += "<td class='center'>"+resultVO.fkdat+"</td>";
		    htmltext += "<td class='center'>"+resultVO.fkimg+"</td>";
		    htmltext += "<td class='center'>"+resultVO.vrkme+"</td>";
		    htmltext += "<td class='center'>"+resultVO.waerk+"</td>";
		    htmltext += "<td class='center'>"+resultVO.netwr+"</td>";
		    htmltext += "<td class='center'>"+resultVO.zfwdr+"</td>";
		    htmltext += "<td class='center'>"+resultVO.name1F+"</td>";
		    htmltext += "<td class='center'>"+resultVO.kunnrN+"</td>";
		    htmltext += "<td class='center'>"+resultVO.name1N+"</td>";
		    htmltext += "<td class='center'>"+resultVO.inco1+"</td>";
		    htmltext += "<td class='center'>"+resultVO.inco2+"</td>";
		    htmltext += "<td class='center'>"+resultVO.zterm+"</td>";
		    htmltext += "<td class='center'>"+resultVO.bukrs+"</td>";
		    htmltext += "<td class='center'>"+resultVO.bsartT+"</td>";
		    htmltext += "</tr>";
		}
		$('#printBtn').show();
		$('#printBtnFst').show();
    }
    $("#gridList > tbody").html(htmltext);
    $("#pagination").quickPager( {
        pageSize: result.paginationInfo.pageSize,
        pageUnit: result.paginationInfo.recordCountPerPage,
        pageIndexId: "pageIndex",
        callback:function() {
        	qryFileList();
        },
        currentPage: result.paginationInfo.currentPageNo,
        totalCount: result.paginationInfo.totalRecordCount,
        searchUrl: "#_"
    });   
}


var printFg = false;
//인쇄
function printFile(flag){
	
	if($('input[name="chkList2"]:checked').size()==0 && $('input[name="chkList"]:checked').size()==0 ){
		alert("인쇄할 서류를 선택해주세요.");
		return;
	}
	
	if(!confirm("수출입 서류를 인쇄하시겠습니까?")){
		 return;
	}
	
	var printProssYn = true;
	var chkFileStr = "";
	var chkFileTypeStr = "";
//	var path = "classes/attach_files/";

// 	$('input[name="chkList2"]:checked').each(function (i) {  
// 		var tmpType = $('input[name="chkList2"]:checked').eq(i).parent().next().next().text();
// 		if(tmpType=="pdf" || tmpType=="xls" || tmpType=="xlsx"){
// 			chkFileStr += $('input[name="chkList2"]:checked').eq(i).val()+",";
// 			chkFileTypeStr += $('input[name="chkList2"]:checked').eq(i).parent().next().next().text()+",";
// 		}else{
// 			printProssYn = false;
// 		}
// 	});  
	
	$('input[name="chkList"]:checked').each(function (i) {  
		var tmpType = $('input[name="chkList"]:checked').eq(i).parent().next().next().text();
		if(tmpType=="pdf" || tmpType=="xls" || tmpType=="xlsx" || tmpType=="png"){
			chkFileStr += $('input[name="chkList"]:checked').eq(i).val()+",";
			chkFileTypeStr += $('input[name="chkList"]:checked').eq(i).parent().next().next().text()+",";
		}else{
			printProssYn = false;
		}
	});  

	if(!printProssYn){
		alert("출력 불가능한 파일형식이 포함되어 있습니다.\n출력 가능한 형식:pdf, xlsx, xls, png");
		return;
	}

	
	var data = {
			filePath:chkFileStr,
			fileType:chkFileTypeStr
	};

	var URL = "";
	if(flag=="A"){
		URL = "/file/printFile";
	}else{
		URL = "/file/printFileFstPage";
	}
		
		
    fc_spinner();

	$.ajax({
	          type : 'POST',
	          data : data,
	          dataType : 'json',
	          beforeSend : function(xhr)
	          {   /*데이터를 전송하기 전에 헤더에 csrf값을 설정한다*/
					xhr.setRequestHeader(header, token); 
	          },   
	          url :  URL,
	          success : function(result) {
	        	  //alert(result.filePath);
     	           	spinner.stop();
	        	  $('#iFramePdf').attr("src",result.reqURL+"/file/fileViewer?filePath="+ result.filePath + "&fileType=pdf");
				  printFg = true; 
	          },
	          error : function(request,status){
	              alert("조회 실패");
	          }
	});
}

//프레임 로드 후 실행
$('#iFramePdf').load( function(){
  	if(printFg){
 		printPdf();
  	}
});

//pdf 프레임 출력
function printPdf(){
 		
	var getMyFrame = document.getElementById("iFramePdf");

   	getMyFrame.focus();
   	getMyFrame.contentWindow.print();   
}

function chkRadio(obj){
	if($(obj).val()=="Q"){
		$('#qryTypeQ').show();
		$('#qryTypeM').hide();
		$('#qryTypeD').hide();
	}else if($(obj).val()=="M"){
		$('#qryTypeM').show();
		$('#qryTypeQ').hide();
		$('#qryTypeD').hide();
	    $.datepicker.monthpicker = {
                closeText: '닫기',
                nextText : '다음 달',
                prevText : '이전 달',
                currentText : "오늘",
                changeMonth : true,
                changeYear : true,
                monthNames : ['1월','2월','3월','4월','5월','6월','7월','8월','9월','10월','11월','12월'],
                monthNamesShort : ['1월','2월','3월','4월','5월','6월','7월','8월','9월','10월','11월','12월'],
                dayNames : [ "일요일", "월요일", "화요일", "수요일", "목요일", "금요일", "토요일" ],
                dayNamesShort : ['일', '월', '화', '수', '목', '금', '토'],
                dayNamesMin : ['일', '월', '화', '수', '목', '금', '토'],
                weekHeader : "주",
                firstDay : 0,
                isRTL : false,
                showMonthAfterYear : true,
                yearSuffix : "년",
                showOn: 'both',
                // buttonText: "달력",
                showButtonPanel: true,
                dateFormat: 'yy-mm',          
                yearRange: "-10:+0"
          };

      $.datepicker.setDefaults($.datepicker.monthpicker);

            var datepicker_default = {
                showOn: 'both',
                changeMonth: true,
                changeYear: true,
                yearRange: 'c-99:c+99',
                showOtherMonths: true,
                selectOtherMonths: true,
		        showButtonPanel: true, 
		        currentText: '이번달', 
		        closeText: '닫기', 
		        showOn:"button",
		        buttonImage: "http://jqueryui.com/resources/demos/datepicker/images/calendar.gif"
            }
            datepicker_default.closeText = "선택";
            datepicker_default.dateFormat = "yy-mm";
            datepicker_default.onClose = function (dateText, inst) {
                var month = $("#ui-datepicker-div .ui-datepicker-month :selected").val();
                var year = $("#ui-datepicker-div .ui-datepicker-year :selected").val();
                $(this).datepicker("option", "defaultDate", new Date(year, month, 1));
                $(this).datepicker('setDate', new Date(year, month, 1));
            }
            datepicker_default.beforeShow = function () {
                var selectDate = $("#qryMBfr").val().split("-");
                var year = Number(selectDate[0]);
                var month = Number(selectDate[1]) - 1;
                $(this).datepicker("option", "defaultDate", new Date(year, month, 1));
            }
            $(".month_picker").datepicker(datepicker_default);
	   	
        	$('#qryMBfr').val(currentYear()+"-"+currentMonth());
        	$('#qryMAftr').val(currentYear()+"-"+currentMonth());
        	
	}else{
		$('#qryTypeD').show();
		$('#qryTypeQ').hide();
		$('#qryTypeM').hide();
		 $( "#qryBfr, #qryAftr").datepicker({
		        showButtonPanel: true, 
		        currentText: '오늘', 
		        closeText: '닫기', 
		        showOn:"button",
		        buttonImage: "http://jqueryui.com/resources/demos/datepicker/images/calendar.gif",
		        dateFormat: "yy-mm-dd"
		 });
		 
     	$('#qryBfr').val(currentYear()+"-"+currentMonth()+"-01");
    	$('#qryAftr').val(getDate(1));
	}
}

function formatDate(obj, flag){
    
	var num = $(obj).val();
	if(num!="") {
	
	    var formatNum = '';
	
	    // 공백제거
	    num = num.replace(/\s/gi, "");
	    
		if(flag=="D"){
		
		    if(num.length == 8) {
		         formatNum = num.replace(/(\d{4})(\d{2})(\d{2})/, '$1-$2-$3');
			    $("#"+$(obj).prop("id")).val(formatNum);
		    }
		    
		}else{
		    if(num.length == 6) {
		         formatNum = num.replace(/(\d{4})(\d{2})/, '$1-$2');
				 $("#"+$(obj).prop("id")).val(formatNum);
		    }
		}
	}

}


</script>
</body>
</html>